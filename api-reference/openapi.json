{
  "openapi": "3.0.3",
  "info": {
    "title": "AscendOTT Aggregator Plans API",
    "description": "API description for aggregators to interact with AscendOTT Sites. When you use the curl command, remember to replace yourdomain.com in the url with the correct OTT domain you are trying to access.",
    "version": "1.0.0",
    "license": { "name": "MIT" }
  },
  "servers": [
    { "url": "https://api.yourdomain.com/api/v1/aggregator" }
  ],
  "security": [
    { "ApiKeyAuth": [] }
  ],
  "paths": {
    "/plans": {
      "get": {
        "summary": "List of plans",
        "description": "Returns all plans from the system that the caller can access.",
        "parameters": [
          {
            "name": "limit",
            "in": "query",
            "description": "The maximum number of results to return",
            "schema": { "type": "integer", "format": "int32" }
          }
        ],
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": { "$ref": "#/components/schemas/Plan" }
                }
              }
            }
          },
          "403": {
            "description": "Forbidden â€” missing or invalid API key",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" },
                "examples": {
                  "missing":   { "value": { "error": "x-api-key missing" } },
                  "incorrect": { "value": { "error": "x-api-key is incorrect" } }
                }
              }
            }
          },
          "500": {
            "description": "Internal Server Error",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" },
                "examples": { "error": { "value": { "error": "Internal Server Error" } } }
              }
            }
          }
        }
      },
      "post": {
        "summary": "Create plan",
        "description": "Creates a new plan in the OTT.",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/NewPlan" }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Plan response",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Plan" }
              }
            }
          },
          "400": {
            "description": "Unexpected error",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "securitySchemes": {
      "ApiKeyAuth": { "type": "apiKey", "in": "header", "name": "x-api-key" }
    },
    "schemas": {
      "Plan": {
        "type": "object",
        "required": ["name"],
        "properties": {
          "name": { "type": "string", "description": "The name of the plan" },
          "tag":  { "type": "string", "description": "Tag to specify the type" }
        }
      },
      "NewPlan": {
        "allOf": [
          { "$ref": "#/components/schemas/Plan" },
          {
            "type": "object",
            "required": ["id"],
            "properties": {
              "id": { "type": "string", "description": "Identification number of the plan" }
            }
          }
        ]
      },
      "Error": {
        "type": "object",
        "required": ["error", "message"],
        "properties": {
          "error":   { "type": "integer", "format": "int32" },
          "message": { "type": "string" }
        }
      }
    }
  }
}
